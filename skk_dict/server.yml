version: 3

tasks:
  gen_yaskkserv2_dict:
    internal: true
    deps:
      - install_deps
    requires:
      vars: [ SERVER_DICT_FILE, SKK_FILE ]
    cmds:
      - echo "Generating {{ .SERVER_DICT_FILE | osBase }}"
      - yaskkserv2_make_dictionary --dictionary-filename="{{ .SERVER_DICT_FILE }}" --utf8 "{{ .SKK_FILE }}"
      - task: lib:verify_candidates
        vars:
          FILE1: "{{ .SKK_FILE }}"
          FILE2: "{{ .SERVER_DICT_FILE }}"
      - echo "Created dictionary with $(skkdic-count {{ .SERVER_DICT_FILE }} | awk '{ print $2 }') candidates."

  update_server_dict:
    desc: "Update the production dictionary of yaskkserv2"
    deps:
      - install_deps
    requires:
      vars: [ SERVER_DICT_FILE ]
    cmds:
      - cp "{{ .SERVER_DICT_FILE }}" "{{ .HOME }}/.yaskkserv2/dictionary"

  restart_server:
    desc: "Restart yaskkserv2"
    deps:
      - install_deps
    cmds:
      - pkill yaskkserv2
      - brew services restart yaskkserv2

  update_server:
    desc: "Update yaskkserv2 build"
    deps:
      - install_deps
    cmds:
      - brew reinstall yaskkserv2
