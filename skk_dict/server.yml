version: 3

tasks:
  gen_yaskkserv2_dict:
    internal: true
    deps:
      - install_deps
    requires:
      vars: [ SERVER_DICT_FILE, SKK_FILE ]
    cmds:
      - echo -n "Generating {{ .SERVER_DICT_FILE | osBase }}"
      - yaskkserv2_make_dictionary --dictionary-filename="{{ .SERVER_DICT_FILE }}" --utf8 "{{ .SKK_FILE }}"
      - echo -n " -> "
      - task: lib:count_entires
        vars:
          FILE: "{{ .SERVER_DICT_FILE }}"

  update_server_dict:
    desc: "Update the production dictionary of yaskkserv2"
    deps:
      - install_deps
    requires:
      vars: [ SERVER_DICT_FILE ]
    cmds:
      - cp "{{ .SERVER_DICT_FILE }}" "{{ .HOME }}/.yaskkserv2/dictionary"

  restart_server:
    desc: "Restart yaskkserv2"
    deps:
      - install_deps
    cmds:
      - pkill yaskkserv2
      - brew services restart yaskkserv2

  update_server:
    desc: "Update yaskkserv2 build"
    deps:
      - install_deps
    cmds:
      - brew reinstall yaskkserv2
